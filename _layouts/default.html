<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>{{ page.title | default: site.title }}</title>
    {% seo %}
  <link rel="stylesheet" href="/assets/custom.css">
  </head>
  <body>
    {% include nav.html %}

    <main class="site-main">
      <div class="container">
        {{ content }}
      </div>
    </main>

    <footer class="site-footer">
      <div class="container">
        <p>&copy; {{ site.title }} Â· {{ site.time | date: '%Y' }}</p>
      </div>
    </footer>
  </body>
  <script>
  // Site theme controller: reads stored preference, falls back to system, and exposes toggle
  ;(function(){
    const root = document.documentElement;
    function getStored(){ return localStorage.getItem('site-theme'); }
    function setTheme(t){ root.setAttribute('data-theme', t); localStorage.setItem('site-theme', t); document.dispatchEvent(new CustomEvent('theme-changed',{detail: t})); updateToggle(t);}    
    function prefersDark(){ return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; }
    function init(){ const stored = getStored(); const theme = stored || (prefersDark() ? 'dark' : 'light'); root.setAttribute('data-theme', theme); updateToggle(theme); }
    function updateToggle(theme){ const btn = document.getElementById('theme-toggle'); if(!btn) return; const pressed = theme === 'dark'; btn.setAttribute('aria-pressed', pressed ? 'true' : 'false'); const sun = document.getElementById('icon-sun'); const moon = document.getElementById('icon-moon'); if(sun && moon){ sun.style.display = pressed ? 'none' : 'inline-block'; moon.style.display = pressed ? 'inline-block' : 'none'; } }
    function toggle(){ const cur = root.getAttribute('data-theme') === 'dark' ? 'dark' : 'light'; setTheme(cur === 'dark' ? 'light' : 'dark'); }
    // attach
    document.addEventListener('DOMContentLoaded', function(){ init(); const tb = document.getElementById('theme-toggle'); if(tb) tb.addEventListener('click', toggle); });

    // When theme changes, notify giscus iframes (global sync)
    document.addEventListener('theme-changed', function(e){
      const theme = e.detail || document.documentElement.getAttribute('data-theme');
      document.querySelectorAll('iframe.giscus-frame, iframe').forEach(function(iframe){
        try{ iframe.contentWindow.postMessage({giscus: {setConfig: {theme: theme}}}, 'https://giscus.app'); }catch(_){}
      });
    });
  })();
  </script>
</html>
